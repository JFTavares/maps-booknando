"use strict";(()=>{var ae=Object.create;var W=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var q=(f,e)=>()=>(e||f((e={exports:{}}).exports,e),e.exports);var ce=(f,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let h of he(e))!ue.call(f,h)&&h!==t&&W(f,h,{get:()=>e[h],enumerable:!(s=le(e,h))||s.enumerable});return f};var B=(f,e,t)=>(t=f!=null?ae(de(f)):{},ce(e||!f||!f.__esModule?W(t,"default",{value:f,enumerable:!0}):t,f));var $=q((R,Z)=>{(function(f,e){typeof define=="function"&&define.amd?define([],e):typeof R=="object"?Z.exports=e():f.download=e()})(R,function(){return function f(e,t,s){var h=window,x="application/octet-stream",_=s||x,v=e,g=!t&&!s&&v,y=document.createElement("a"),i=function(u){return String(u)},r=h.Blob||h.MozBlob||h.WebKitBlob||i,n=t||"download",o,d;if(r=r.call?r.bind(h):Blob,String(this)==="true"&&(v=[v,_],_=v[0],v=v[1]),g&&g.length<2048&&(n=g.split("/").pop().split("?")[0],y.href=g,y.href.indexOf(g)!==-1)){var c=new XMLHttpRequest;return c.open("GET",g,!0),c.responseType="blob",c.onload=function(u){f(u.target.response,n,x)},setTimeout(function(){c.send()},0),c}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(v))if(v.length>1024*1024*1.999&&r!==i)v=l(v),_=v.type||x;else return navigator.msSaveBlob?navigator.msSaveBlob(l(v),n):b(v);else if(/([\x80-\xff])/.test(v)){var m=0,A=new Uint8Array(v.length),a=A.length;for(m;m<a;++m)A[m]=v.charCodeAt(m);v=new r([A],{type:_})}o=v instanceof r?v:new r([v],{type:_});function l(u){var p=u.split(/[:;,]/),w=p[1],C=p[2]=="base64"?atob:decodeURIComponent,k=C(p.pop()),G=k.length,O=0,K=new Uint8Array(G);for(O;O<G;++O)K[O]=k.charCodeAt(O);return new r([K],{type:w})}function b(u,p){if("download"in y)return y.href=u,y.setAttribute("download",n),y.className="download-js-link",y.innerHTML="downloading...",y.style.display="none",document.body.appendChild(y),setTimeout(function(){y.click(),document.body.removeChild(y),p===!0&&setTimeout(function(){h.URL.revokeObjectURL(y.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,x)),window.open(u)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=u),!0;var w=document.createElement("iframe");document.body.appendChild(w),!p&&/^data:/.test(u)&&(u="data:"+u.replace(/^data:([\w\/\-\+]+)/,x)),w.src=u,setTimeout(function(){document.body.removeChild(w)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(o,n);if(h.URL)b(h.URL.createObjectURL(o),!0);else{if(typeof o=="string"||o.constructor===i)try{return b("data:"+_+";base64,"+h.btoa(o))}catch(u){return b("data:"+_+","+encodeURIComponent(o))}d=new FileReader,d.onload=function(u){b(this.result)},d.readAsDataURL(o)}return!0}})});var ee=q((Se,Y)=>{(function(){"use strict";function f(t,s,h){return t.splice(s,!h||1+h-s+(!(h<0^s>=0)&&(h<0||-1)*t.length)),t.length}var e=function(){var t=[],s=-1,h=0,x=!1,_,v;return v=function(g,y){return!g||typeof g[y]!="function"?this:(x=!0,g[y](),x=!1,this)},{add:function(g){return x?this:(t.splice(s+1,t.length-s),t.push(g),h&&t.length>h&&f(t,0,-(h+1)),s=t.length-1,_&&_(),this)},setCallback:function(g){_=g},undo:function(){var g=t[s];return g?(v(g,"undo"),s-=1,_&&_(),this):this},redo:function(){var g=t[s+1];return g?(v(g,"redo"),s+=1,_&&_(),this):this},clear:function(){var g=t.length;t=[],s=-1,_&&g>0&&_()},hasUndo:function(){return s!==-1},hasRedo:function(){return s<t.length-1},getCommands:function(){return t},getIndex:function(){return s},setLimit:function(g){h=g}}};typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return e}):typeof Y!="undefined"&&Y.exports?Y.exports=e:window.UndoManager=e})()});var ie=q((te,j)=>{(function(){function f(i,r){var n=t("div",null,"qs_label",r);return n.innerHTML=i,n}function e(i,r,n,o){var d=t("input",r,n,o);return d.type=i,d}function t(i,r,n,o){var d=document.createElement(i);if(d)return d.id=r,n&&(d.className=n),o&&o.appendChild(d),d}function s(){return navigator.userAgent.indexOf("rv:11")!=-1||navigator.userAgent.indexOf("MSIE")!=-1}function h(){var i=navigator.userAgent.toLowerCase();return!(i.indexOf("chrome")>-1||i.indexOf("firefox")>-1||i.indexOf("epiphany")>-1)&&i.indexOf("safari/")>-1}function x(){var i=navigator.userAgent.toLowerCase();return i.indexOf("edge")>-1}function _(){var i=document.createElement("style");i.innerText=g,document.head.appendChild(i),v=!0}var v=!1,g=".qs_main{background-color:#dddddd;text-align:left;position:absolute;width:200px;font:12px sans-serif;box-shadow:5px 5px 8px rgba(0,0,0,0.35);user-select:none;-webkit-user-select:none;color:#000000;border:none}.qs_content{background-color:#cccccc;overflow-y:auto}.qs_title_bar{background-color:#eeeeee;user-select:none;-webkit-user-select:none;cursor:pointer;padding:5px;font-weight:bold;border:none;color:#000000}.qs_container{margin:5px;padding:5px;background-color:#eeeeee;border:none;position:relative}.qs_container_selected{border:none;background-color:#ffffff}.qs_range{-webkit-appearance:none;-moz-appearance:none;width:100%;height:17px;padding:0;margin:0;background-color:transparent;border:none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_range:focus{outline:none;border:none}.qs_range::-webkit-slider-runnable-track{width:100%;height:15px;cursor:pointer;background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-webkit-slider-runnable-track{background:#cccccc}.qs_range::-webkit-slider-thumb{-webkit-appearance:none;height:15px;width:15px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer;margin-top:0}.qs_range::-moz-range-track{width:100%;height:15px;cursor:pointer;background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range::-moz-range-thumb{height:15px;width:15px;border:none;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer}.qs_range::-ms-track{width:100%;height:15px;cursor:pointer;visibility:hidden;background:transparent}.qs_range::-ms-thumb{height:15px;width:15px;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;background:#999999;cursor:pointer;border:none}.qs_range::-ms-fill-lower{background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-ms-fill-lower{background:#cccccc}.qs_range::-ms-fill-upper{background:#cccccc;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.qs_range:focus::-ms-fill-upper{background:#cccccc}.qs_button{background-color:#f6f6f6;color:#000000;height:30px;border:1px solid #aaaaaa;font:12px sans-serif}.qs_button:active{background-color:#ffffff;border:1px solid #aaaaaa}.qs_button:focus{border:1px solid #aaaaaa;outline:none}.qs_checkbox{cursor:pointer}.qs_checkbox input{position:absolute;left:-99999px}.qs_checkbox span{height:16px;width:100%;display:block;text-indent:20px;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAALklEQVQ4T2OcOXPmfwYKACPIgLS0NLKMmDVrFsOoAaNhMJoOGBioFwZkZUWoJgApdFaxjUM1YwAAAABJRU5ErkJggg==') no-repeat}.qs_checkbox input:checked+span{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvElEQVQ4T63Tyw2EIBAA0OFKBxBL40wDRovAUACcKc1IB1zZDAkG18GYZTmSmafzgTnnMgwchoDWGlJKheGcP3JtnPceCqCUAmttSZznuYtgchsXQrgC+77DNE0kUpPbmBOoJaBOIVQylnqWgAAeKhDve/AN+EaklJBzhhgjWRoJVGTbNjiOowAIret6a+4jYIwpX8aDwLIs74C2D0IIYIyVP6Gm898m9kbVm85ljHUTf16k4VUefkwDrxk+zoUEwCt0GbUAAAAASUVORK5CYII=') no-repeat}.qs_checkbox_label{position:absolute;top:7px;left:30px}.qs_label{margin-bottom:3px;user-select:none;-webkit-user-select:none;cursor:default;font:12px sans-serif}.qs_text_input{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;width:100%;padding:0 0 0 5px;height:24px;border:1px inset #ffffff;background-color:#ffffff;color:#000000;font-size:12px}.qs_text_input:focus{outline:none;background:#ffffff;border:1px inset #ffffff}.qs_select{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAp0lEQVRIS+2SsQ3FIAwF7RVYhA5mgQFhFuhYhJKWL0eKxI8SGylKZ0p4+OBsHGNM+HChAiS7qkgyBKrovaLeOxhjbgtxZ+cFtgelFMg5QwgBvPd/EO5sDbKAlBLUWo/8CjmL075zDmKMj6rEKbpCqBL9aqc4ZUQAhVbInBMQUXz5Vg/WfxOktXZsWWtZLds9uIqlqaH1NFV3jdhSJA47E1CAaE8ViYp+wGiWMZ/T+cgAAAAASUVORK5CYII=') no-repeat right #f6f6f6;-webkit-appearance:none;-moz-appearance:none;appearance:none;color:#000000;width:100%;height:24px;border:1px solid #aaaaaa;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;padding:0 5px;-moz-outline:none;font-size:14px}.qs_select option{font-size:14px}.qs_select::-ms-expand{display:none}.qs_select:focus{outline:none}.qs_number{height:24px}.qs_image{width:100%}.qs_progress{width:100%;height:15px;background-color:#cccccc;border:none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_progress_value{height:100%;background-color:#999999}.qs_textarea{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;resize:vertical;width:100%;padding:3px 5px;border:1px inset #ffffff;background-color:#ffffff;color:#000000;font-size:12px}.qs_textarea:focus{outline:none;background:#ffffff;border:1px inset #ffffff}.qs_color{position:absolute;left:-999999px}.qs_color_label{width:100%;height:20px;display:block;border:1px solid #aaaaaa;cursor:pointer;padding:0 0 0 5px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.qs_file_chooser{position:absolute;left:-999999px}.qs_file_chooser_label{background-color:#f6f6f6;color:#000000;height:30px;border:1px solid #aaaaaa;font:12px sans-serif;width:100%;display:block;cursor:pointer;padding:7px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}",y={_version:"2.1",_topZ:1,_panel:null,_titleBar:null,_content:null,_startX:0,_startY:0,_hidden:!1,_collapsed:!1,_controls:null,_keyCode:-1,_draggable:!0,_collapsible:!0,_globalChangeHandler:null,useExtStyleSheet:function(){v=!0},create:function(i,r,n,o){var d=Object.create(this);return d._init(i,r,n,o),d},destroy:function(){this._panel.parentElement&&this._panel.parentElement.removeChild(this._panel);for(var i in this)this[i]=null},_init:function(i,r,n,o){v||_(),this._bindHandlers(),this._createPanel(i,r,o),this._createTitleBar(n||"QuickSettings"),this._createContent()},_bindHandlers:function(){this._startDrag=this._startDrag.bind(this),this._drag=this._drag.bind(this),this._endDrag=this._endDrag.bind(this),this._doubleClickTitle=this._doubleClickTitle.bind(this),this._onKeyUp=this._onKeyUp.bind(this)},getValuesAsJSON:function(i){var r={};for(var n in this._controls)this._controls[n].getValue&&(r[n]=this._controls[n].getValue());return i&&(r=JSON.stringify(r)),r},setValuesFromJSON:function(i){typeof i=="string"&&(i=JSON.parse(i));for(var r in i)this._controls[r].setValue&&this._controls[r].setValue(i[r]);return this},saveInLocalStorage:function(i){return this._localStorageName=i,this._readFromLocalStorage(i),this},clearLocalStorage:function(i){return localStorage.removeItem(i),this},_saveInLocalStorage:function(i){localStorage.setItem(i,this.getValuesAsJSON(!0))},_readFromLocalStorage:function(i){var r=localStorage.getItem(i);r&&this.setValuesFromJSON(r)},_createPanel:function(i,r,n){this._panel=t("div",null,"qs_main",n||document.body),this._panel.style.zIndex=++y._topZ,this.setPosition(i||0,r||0),this._controls={}},_createTitleBar:function(i){this._titleBar=t("div",null,"qs_title_bar",this._panel),this._titleBar.textContent=i,this._titleBar.addEventListener("mousedown",this._startDrag),this._titleBar.addEventListener("dblclick",this._doubleClickTitle)},_createContent:function(){this._content=t("div",null,"qs_content",this._panel)},_createContainer:function(){var i=t("div",null,"qs_container");return i.addEventListener("focus",function(){this.className+=" qs_container_selected"},!0),i.addEventListener("blur",function(){var r=this.className.indexOf(" qs_container_selected");r>-1&&(this.className=this.className.substr(0,r))},!0),this._content.appendChild(i),i},setPosition:function(i,r){return this._panel.style.left=i+"px",this._panel.style.top=Math.max(r,0)+"px",this},setSize:function(i,r){return this._panel.style.width=i+"px",this._content.style.width=i+"px",this._content.style.height=r-this._titleBar.offsetHeight+"px",this},setWidth:function(i){return this._panel.style.width=i+"px",this._content.style.width=i+"px",this},setHeight:function(i){return this._content.style.height=i-this._titleBar.offsetHeight+"px",this},setDraggable:function(i){return this._draggable=i,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},_startDrag:function(i){this._draggable&&(this._panel.style.zIndex=++y._topZ,document.addEventListener("mousemove",this._drag),document.addEventListener("mouseup",this._endDrag),this._startX=i.clientX,this._startY=i.clientY),i.preventDefault()},_drag:function(i){var r=parseInt(this._panel.style.left),n=parseInt(this._panel.style.top),o=i.clientX,d=i.clientY;this.setPosition(r+o-this._startX,n+d-this._startY),this._startX=o,this._startY=d,i.preventDefault()},_endDrag:function(i){document.removeEventListener("mousemove",this._drag),document.removeEventListener("mouseup",this._endDrag),i.preventDefault()},setGlobalChangeHandler:function(i){return this._globalChangeHandler=i,this},_callGCH:function(){this._localStorageName&&this._saveInLocalStorage(this._localStorageName),this._globalChangeHandler&&this._globalChangeHandler()},hide:function(){return this._panel.style.visibility="hidden",this._hidden=!0,this},show:function(){return this._panel.style.visibility="visible",this._panel.style.zIndex=++y._topZ,this._hidden=!1,this},toggleVisibility:function(){return this._hidden?this.show():this.hide(),this},setCollapsible:function(i){return this._collapsible=i,this._draggable||this._collapsible?this._titleBar.style.cursor="pointer":this._titleBar.style.cursor="default",this},collapse:function(){return this._panel.removeChild(this._content),this._collapsed=!0,this},expand:function(){return this._panel.appendChild(this._content),this._collapsed=!1,this},toggleCollapsed:function(){return this._collapsed?this.expand():this.collapse(),this},setKey:function(i){return this._keyCode=i.toUpperCase().charCodeAt(0),document.body.addEventListener("keyup",this.onKeyUp),this},_onKeyUp:function(i){i.keyCode===this._keyCode&&this.toggleVisibility()},_doubleClickTitle:function(){this._collapsible&&this.toggleCollapsed()},removeControl:function(i){if(this._controls[i])var r=this._controls[i].container;return r&&r.parentElement&&r.parentElement.removeChild(r),this._controls[i]=null,this},enableControl:function(i){return this._controls[i]&&(this._controls[i].control.disabled=!1),this},disableControl:function(i){return this._controls[i]&&(this._controls[i].control.disabled=!0),this},hideControl:function(i){return this._controls[i]&&(this._controls[i].container.style.display="none"),this},showControl:function(i){return this._controls[i]&&(this._controls[i].container.style.display="block"),this},overrideStyle:function(i,r,n){return this._controls[i]&&(this._controls[i].control.style[r]=n),this},hideTitle:function(i){var r=this._controls[i].label;return r&&(r.style.display="none"),this},showTitle:function(i){var r=this._controls[i].label;return r&&(r.style.display="block"),this},hideAllTitles:function(){for(var i in this._controls){var r=this._controls[i].label;r&&(r.style.display="none")}return this},showAllTitles:function(){for(var i in this._controls){var r=this._controls[i].label;r&&(r.style.display="block")}return this},getValue:function(i){return this._controls[i].getValue()},setValue:function(i,r){return this._controls[i].setValue(r),this._callGCH(),this},addBoolean:function(i,r,n){var o=this._createContainer(),d=t("label",null,"qs_checkbox_label",o);d.textContent=i,d.setAttribute("for",i);var c=t("label",null,"qs_checkbox",o);c.setAttribute("for",i);var m=e("checkbox",i,null,c);m.checked=r,t("span",null,null,c),this._controls[i]={container:o,control:m,getValue:function(){return this.control.checked},setValue:function(a){this.control.checked=a,n&&n(a)}};var A=this;return m.addEventListener("change",function(){n&&n(m.checked),A._callGCH()}),this},bindBoolean:function(i,r,n){return this.addBoolean(i,r,function(o){n[i]=o})},addButton:function(i,r){var n=this._createContainer(),o=e("button",i,"qs_button",n);o.value=i,this._controls[i]={container:n,control:o};var d=this;return o.addEventListener("click",function(){r&&r(o),d._callGCH()}),this},addColor:function(i,r,n){if(h()||x()||s())return this.addText(i,r,n);var o=this._createContainer(),d=f("<b>"+i+":</b> "+r,o),c=e("color",i,"qs_color",o);c.value=r||"#ff0000";var m=t("label",null,"qs_color_label",o);m.setAttribute("for",i),m.style.backgroundColor=c.value,this._controls[i]={container:o,control:c,colorLabel:m,label:d,title:i,getValue:function(){return this.control.value},setValue:function(a){this.control.value=a,this.colorLabel.style.backgroundColor=c.value,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,n&&n(a)}};var A=this;return c.addEventListener("input",function(){d.innerHTML="<b>"+i+":</b> "+c.value,m.style.backgroundColor=c.value,n&&n(c.value),A._callGCH()}),this},bindColor:function(i,r,n){return this.addColor(i,r,function(o){n[i]=o})},addDate:function(i,r,n){var o;if(r instanceof Date){var d=r.getFullYear(),c=r.getMonth()+1;c<10&&(c="0"+c);var m=r.getDate();o=d+"-"+c+"-"+m}else o=r;if(s())return this.addText(i,o,n);var A=this._createContainer(),a=f("<b>"+i+"</b>",A),l=e("date",i,"qs_text_input",A);l.value=o||"",this._controls[i]={container:A,control:l,label:a,getValue:function(){return this.control.value},setValue:function(u){var p;if(u instanceof Date){var w=u.getFullYear(),C=u.getMonth()+1;C<10&&(C="0"+C);var k=u.getDate();k<10&&(k="0"+k),p=w+"-"+C+"-"+k}else p=u;this.control.value=p||"",n&&n(p)}};var b=this;return l.addEventListener("input",function(){n&&n(l.value),b._callGCH()}),this},bindDate:function(i,r,n){return this.addDate(i,r,function(o){n[i]=o})},addDropDown:function(i,r,n){for(var o=this._createContainer(),d=f("<b>"+i+"</b>",o),c=t("select",null,"qs_select",o),m=0;m<r.length;m++){var A=t("option");A.label=r[m],A.innerText=r[m],c.add(A)}var a=this;return c.addEventListener("change",function(){var l=c.selectedIndex,b=c.options;n&&n({index:l,value:b[l].label}),a._callGCH()}),this._controls[i]={container:o,control:c,label:d,getValue:function(){var l=this.control.selectedIndex;return{index:l,value:this.control.options[l].label}},setValue:function(l){var b;b=l.index!=null?l.index:l;var u=this.control.options;this.control.selectedIndex=b,n&&n({index:b,value:u[b].label})}},this},bindDropDown:function(i,r,n){return this.addDropDown(i,r,function(o){n[i]=o.value})},addElement:function(i,r){var n=this._createContainer(),o=f("<b>"+i+"</b>",n);return n.appendChild(r),this._controls[i]={container:n,label:o},this},addFileChooser:function(i,r,n,o){var d=this._createContainer(),c=f("<b>"+i+"</b>",d),m=e("file",i,"qs_file_chooser",d);n&&(m.accept=n);var A=t("label",null,"qs_file_chooser_label",d);A.setAttribute("for",i),A.textContent=r||"Choose a file...",this._controls[i]={container:d,control:m,label:c,getValue:function(){return this.control.files[0]}};var a=this;return m.addEventListener("change",function(){m.files&&m.files.length&&(A.textContent=m.files[0].name,o&&o(m.files[0]),a._callGCH())}),this},addHTML:function(i,r){var n=this._createContainer(),o=f("<b>"+i+":</b> ",n),d=t("div",null,null,n);return d.innerHTML=r,this._controls[i]={label:o,control:d,getValue:function(){return this.control.innerHTML},setValue:function(c){this.control.innerHTML=c}},this},addImage:function(i,r){var n=this._createContainer(),o=f("<b>"+i+"</b>",n);return img=t("img",null,"qs_image",n),img.src=r,this._controls[i]={container:n,control:img,label:o,getValue:function(){return this.control.src},setValue:function(d){this.control.src=d}},this},addRange:function(i,r,n,o,d,c){return this._addNumber("range",i,r,n,o,d,c)},addNumber:function(i,r,n,o,d,c){return this._addNumber("number",i,r,n,o,d,c)},_addNumber:function(i,r,n,o,d,c,m){var A=this._createContainer(),a=f("",A),l=i==="range"?"qs_range":"qs_text_input qs_number",b=e(i,r,l,A);b.min=n||0,b.max=o||100,b.step=c||1,b.value=d||0,a.innerHTML="<b>"+r+":</b> "+b.value,this._controls[r]={container:A,control:b,label:a,title:r,callback:m,getValue:function(){return parseFloat(this.control.value)},setValue:function(w){this.control.value=w,this.label.innerHTML="<b>"+this.title+":</b> "+this.control.value,m&&m(parseFloat(w))}};var u="input";i==="range"&&s()&&(u="change");var p=this;return b.addEventListener(u,function(){a.innerHTML="<b>"+r+":</b> "+b.value,m&&m(parseFloat(b.value)),p._callGCH()}),this},bindRange:function(i,r,n,o,d,c){return this.addRange(i,r,n,o,d,function(m){c[i]=m})},bindNumber:function(i,r,n,o,d,c){return this.addNumber(i,r,n,o,d,function(m){c[i]=m})},setRangeParameters:function(i,r,n,o){return this.setNumberParameters(i,r,n,o)},setNumberParameters:function(i,r,n,o){var d=this._controls[i],c=d.control.value;return d.control.min=r,d.control.max=n,d.control.step=o,d.control.value!==c&&d.callback&&d.callback(d.control.value),this},addPassword:function(i,r,n){return this._addText("password",i,r,n)},bindPassword:function(i,r,n){return this.addPassword(i,r,function(o){n[i]=o})},addProgressBar:function(i,r,n,o){var d=this._createContainer(),c=f("",d),m=t("div",null,"qs_progress",d),A=t("div",null,"qs_progress_value",m);return A.style.width=n/r*100+"%",o==="numbers"?c.innerHTML="<b>"+i+":</b> "+n+" / "+r:o==="percent"?c.innerHTML="<b>"+i+":</b> "+Math.round(n/r*100)+"%":c.innerHTML="<b>"+i+"</b>",this._controls[i]={container:d,control:m,valueDiv:A,valueDisplay:o,label:c,value:n,max:r,title:i,getValue:function(){return this.value},setValue:function(a){this.value=Math.max(0,Math.min(a,this.max)),this.valueDiv.style.width=this.value/this.max*100+"%",this.valueDisplay==="numbers"?this.label.innerHTML="<b>"+this.title+":</b> "+this.value+" / "+this.max:this.valueDisplay==="percent"&&(this.label.innerHTML="<b>"+this.title+":</b> "+Math.round(this.value/this.max*100)+"%")}},this},setProgressMax:function(i,r){var n=this._controls[i];return n.max=r,n.value=Math.min(n.value,n.max),n.valueDiv.style.width=n.value/n.max*100+"%",n.valueDisplay==="numbers"?n.label.innerHTML="<b>"+n.title+":</b> "+n.value+" / "+n.max:n.valueDisplay==="percent"?n.label.innerHTML="<b>"+n.title+":</b> "+Math.round(n.value/n.max*100)+"%":n.label.innerHTML="<b>"+n.title+"</b>",this},addText:function(i,r,n){return this._addText("text",i,r,n)},_addText:function(i,r,n,o){var d,c=this._createContainer(),m=f("<b>"+r+"</b>",c);i==="textarea"?(d=t("textarea",r,"qs_textarea",c),d.rows=5):d=e(i,r,"qs_text_input",c),d.value=n||"",this._controls[r]={container:c,control:d,label:m,getValue:function(){return this.control.value},setValue:function(a){this.control.value=a,o&&o(a)}};var A=this;return d.addEventListener("input",function(){o&&o(d.value),A._callGCH()}),this},bindText:function(i,r,n){return this.addText(i,r,function(o){n[i]=o})},addTextArea:function(i,r,n){return this._addText("textarea",i,r,n)},setTextAreaRows:function(i,r){return this._controls[i].control.rows=r,this},bindTextArea:function(i,r,n){return this.addTextArea(i,r,function(o){n[i]=o})},addTime:function(i,r,n){var o;if(r instanceof Date){var d=r.getHours();d<10&&(d="0"+d);var c=r.getMinutes();c<10&&(c="0"+c);var m=r.getSeconds();m<10&&(m="0"+m),o=d+":"+c+":"+m}else o=r;if(s())return this.addText(i,o,n);var A=this._createContainer(),a=f("<b>"+i+"</b>",A),l=e("time",i,"qs_text_input",A);l.value=o||"",this._controls[i]={container:A,control:l,label:a,getValue:function(){return this.control.value},setValue:function(u){var p;if(u instanceof Date){var w=u.getHours();w<10&&(w="0"+w);var C=u.getMinutes();C<10&&(C="0"+C);var k=u.getSeconds();k<10&&(k="0"+k),p=w+":"+C+":"+k}else p=u;this.control.value=p||"",n&&n(p)}};var b=this;return l.addEventListener("input",function(){n&&n(l.value),b._callGCH()}),this},bindTime:function(i,r,n){return this.addTime(i,r,function(o){n[i]=o})}};typeof te=="object"&&typeof j=="object"?j.exports=y:typeof define=="function"&&define.amd?define(y):window.QuickSettings=y})()});var re=q((Te,U)=>{"use strict";(function(){"use strict";var f={event:"click",position:"bottom",horizontalOffset:0,verticalOffset:0,data:{}},e=!1,t=null,s="context-menu",h="context-menu-item",x="context-menu-item-disabled",_=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},v=function(a){return typeof a=="string"||a instanceof String},g=function(a){var l=arguments.length;if(l<2||a===null)return a;for(var b=1;b<l;b++){var u=arguments[b];for(var p in u)a[p]=u[p]}return a},y=function(a){var l=[];return typeof jQuery!="undefined"&&a instanceof jQuery?a:a instanceof HTMLElement?[a]:v(a)?document.querySelectorAll(a):a instanceof NodeList?a:l},i=function(a){if(a.stopPropagation(),a.preventDefault(),t=a.target,d(),t.ctxMenu){var l=r(t);document.body.appendChild(l),e=!0,setTimeout(function(){window.addEventListener("click",d),window.addEventListener("resize",d),window.addEventListener("scroll",d),l.style.visibility="visible",n(a,t,l)},1)}},r=function(a){var l,b=document.createElement("div");b.className=s,b.style.visibility="hidden",b.style.display="inline-block";for(l in a.ctxMenu.menu){var u=a.ctxMenu.menu[l],p=document.createElement("div");p.ctxMenu={key:l,enabled:!!u.enabled},p.ctxMenu.enabled?p.className=h:p.className=x,p.innerHTML=u&&u.label?u.label:l,p.ctxMenu.enabled&&(_(u.onSelect)?p.ctxMenu.onSelect=u.onSelect:p.ctxMenu.onSelect=o,p.addEventListener(a.ctxMenu.event,function(w){this.ctxMenu.onSelect(a,this.ctxMenu.key,p,a.ctxMenu.data),d()})),u.title&&(p.title=u.title),b.appendChild(p)}return b},n=function(a,l,b){var u=0,p=0,w=l.getBoundingClientRect(),C=b.getBoundingClientRect(),k="click";l.ctxMenu&&l.ctxMenu.position&&(k=l.ctxMenu.position),k==="bottom"?(u=w.left+l.ctxMenu.horizontalOffset,p=w.bottom+l.ctxMenu.verticalOffset):k==="top"?(u=w.left+l.ctxMenu.horizontalOffset,p=w.top-C.height+l.ctxMenu.verticalOffset):k==="right"?(u=w.left+w.width+l.ctxMenu.horizontalOffset,p=w.top+l.ctxMenu.verticalOffset):k==="left"?(u=w.left-C.width+l.ctxMenu.horizontalOffset,p=w.top+l.ctxMenu.verticalOffset):(u=a.clientX+l.ctxMenu.horizontalOffset,p=a.clientY+l.ctxMenu.verticalOffset),u<0&&(l.ctxMenu.horizontalOffset>=0?u=l.ctxMenu.horizontalOffset:u=0),p<0&&(l.ctxMenu.verticalOffset>=0?p=l.ctxMenu.verticalOffset:p=0),u+C.width>document.body.clientWidth&&(l.ctxMenu.horizontalOffset>=0?u=document.body.clientWidth-C.width:u=document.body.clientWidth-C.width+l.ctxMenu.horizontalOffset),p+C.height>document.body.clientHeight&&(l.ctxMenu.verticalOffset>=0?p=document.body.clientHeight-C.height:p=document.body.clientHeight-C.height+l.ctxMenu.verticalOffset),b.style.left=u+"px",b.style.top=p+"px"},o=function(a,l,b){},d=function(){var a=0,l=document.getElementsByClassName(s);for(window.removeEventListener("click",d),window.removeEventListener("resize",d),window.removeEventListener("scroll",d),a=0;a<l.length;a++)l[a].parentNode.removeChild(l[a]);e=!1},c=function(a,l,b){var u=0,p=y(a);for(u=0;u<p.length;u++)p[u].ctxMenu.menu.hasOwnProperty(l)&&(p[u].ctxMenu.menu[l].enabled=b)},m=function(a){var l,b={type:"item",enabled:!0,label:"",onSelect:function(){},icon:"",title:""};for(l in a){var u=g({},b);a[l]?_(a[l])?a[l]=g(u,{label:l,onSelect:a[l]}):a[l]=g(u,a[l]):a[l]=g(u,{label:l})}return a},A={attach:function(a,l,b){var u=0;l=m(l);var p=g({menu:g({},l)},f,b),w=y(a);for(u=0;u<w.length;u++)w[u].ctxMenu=p,w[u].addEventListener(p.event,i)},display:function(a,l,b){l=m(g({},l));var u=g({menu:g({},l)},f,b);if(a instanceof Event)a.target.ctxMenu=u,i(a);else if(typeof jQuery!="undefined"&&a instanceof jQuery.Event)a.target.ctxMenu=u,i(a);else if(a instanceof HTMLElement){a.ctxMenu=u;var p=a.getBoundingClientRect(),w={target:a,clientX:p.left,clientY:p.top,stopPropagation:function(){},preventDefault:function(){}};i(w)}else console.log(a)},disable:function(a,l){c(a,l,!1)},enable:function(a,l){c(a,l,!0)},close:function(){d()},isOpen:function(){return e}};typeof window.define=="function"&&window.define.amd!==void 0?window.define("ContextMenu",[],function(){return A}):typeof U!="undefined"&&U.exports!==void 0?U.exports=A:window.ContextMenu=A})()});var Q="2.0.0";function D(f,e){return parseFloat(f.toFixed(e))}function J(f,e=400,t=300){window.open(f,"_blank",`width=${e},height=${t}`)}var M=class f{constructor(e=0,t=0){this.x=e;this.y=t}set(e,t){return this.x=e,this.y=t,this}static fromObject(e){return new f(e.x,e.y)}static dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static swap(e,t,s){let h=e[s];e[s]=t[s],t[s]=h}isEmpty(){return!this.x&&!this.y}oneIsEmpty(){return!this.x||!this.y}sum(e){return new f(this.x+e.x,this.y+e.y)}add(e){return this.x+=e.x,this.y+=e.y,this}diff(e){return new f(this.x-e.x,this.y-e.y)}sub(e){return this.x-=e.x,this.y-=e.y,this}move(e){this.add(e)}getPosition(){return this}setPosition(e){return this.set(e.x,e.y),this}clone(){return new f(this.x,this.y)}invert(){return new f(-this.x,-this.y)}toStr(e,t,s){return D(this[t]*s,e).toString()}toHtml(e,t=1){return this.toStr(e,"x",t)+","+this.toStr(e,"y",t)}};var S=class{constructor(e,t=[],s="",h="",x=0){this.shape=e;this.coords=t;this.href=s;this.title=h;this.id=x}static fromObject(e){switch(e.shape){case"rect":let t=e;return new P(t.coords.map(M.fromObject),t.href,t.title,t.id);case"circle":let s=e;return new H(s.coords.map(M.fromObject),s.radius,s.href,s.title,s.id);case"poly":let h=e;return new E(h.coords.map(M.fromObject),h.href,h.title,h.id,h.closed);case"default":let x=e;return new z(x.iMap,x.href,x.title);default:throw"Not an area"}}getId(){return this.id}setShape(e){return this.shape=e,this}getShape(){return this.shape}addCoord(e){return this.coords.push(e)}setCoords(e){return this.coords=e,this}getCoords(){return this.coords}drawingCoords(){return this.coords.slice()}getPoints(){return this.coords}isEmpty(){return this.coords.length==0}equals(e){return this.id==e.id}copyCoords(){let e=[];return this.coords.forEach((t,s)=>{e[s]=new M(t.x,t.y)}),e}updateLastCoord(e){return this.coords[this.coords.length-1]=e,this}move(e){let t=this.firstCoord();e!=null&&t.add(e)}getPosition(){return this.firstCoord()}setPosition(e){let t=this.coords[0].diff(e);this.move(t)}isValidShape(){return this.isDrawable()}isOverPoint(e,t){let s=this.getPoints().find(h=>M.dist(e,h)<t);return s||!1}setHref(e){return this.href=e,this}getHref(){return this.href}getHrefVerbose(){return this.href===""?"undefined":this.href}setTitle(e){return this.title=e,this}getTitle(){return this.title}setId(e){return this.id=e,this}firstCoord(){return this.coords[0]}htmlCoords(e,t){return this.drawingCoords().map(s=>s.toHtml(e,t)).join(",")}toHtml(e=1){let t=this.htmlCoords(0,e);t=t?`coords="${t}"`:"";let s=this.href?`href="${this.href}"`:"nohref",h=this.title?`title="${this.title}"`:"";return`<area shape="${this.shape}" ${t} ${s} alt="${this.href}" ${h} />`}toSvg(e=1){return`<a xlink:href="${this.href}">${this.svgArea(e)}</a>`}},T=class extends S{constructor(){super("empty")}isDrawable(){return!1}svgArea(e){return""}isOver(e){return!1}display(e){}},H=class extends S{constructor(t=[],s=0,h="",x="",_=0){super("circle",t,h,x,_);this.radius=s}getCenter(){return this.firstCoord()}isValidShape(){return super.isValidShape()&&this.radius>0}isDrawable(){return this.coords.length==1}isOver(t){let s=this.getCenter();return M.dist(t,s)<this.radius}updateLastCoord(t){let s=this.getCenter();return this.radius=M.dist(s,t),this}display(t){t.ellipse(this.getCenter().x,this.getCenter().y,this.radius*2)}htmlCoords(t,s){return this.getCenter().toHtml(t,s)+","+D(this.radius,t)}svgArea(t){let s=this.coords[0].toStr(0,"x",t),h=this.coords[0].toStr(0,"y",t),x=D(this.radius,0);return`<circle cx="${s}" cy="${h}" r="${x}" />`}},E=class extends S{constructor(t=[],s="",h="",x=0,_=!1){super("poly",t,s,h,x);this.closed=_}isDrawable(){return this.coords.length>=2}isValidShape(){return super.isValidShape()&&this.closed}isOver(t){let s=t.x,h=t.y,x=this.coords.map(n=>n.x),_=this.coords.map(n=>n.y),v,g=x.length-1,y=0,i=x,r=_;for(v=0;v<x.length;v++)(r[v]<h&&r[g]>=h||r[g]<h&&r[v]>=h)&&(i[v]<=s||i[g]<=s)&&(y^=i[v]+(h-r[v])/(r[g]-r[v])*(i[g]-i[v])<s?1:0),g=v;return!!y}isClosable(t,s){let h=M.dist(t,this.firstCoord());return this.coords.length>=4&&h<s}drawingCoords(){let t=super.drawingCoords();return this.closed&&t.push(this.firstCoord()),t}close(){return this.closed=!0,this.coords.pop(),this}move(t){this.coords.map(s=>s.add(t))}display(t){t.beginShape(),this.drawingCoords().forEach(s=>t.vertex(s.x,s.y)),t.endShape()}svgArea(t){return`<polygon points="${this.drawingCoords().map(h=>h.toStr(0,"x",t)+","+h.toStr(0,"y",t)).join(" ")}" />`}},P=class extends E{constructor(e=[],t="",s="",h=0){if(super(e,t,s,h,!0),this.coords.length>0&&this.coords.length<4){let x=this.firstCoord();this.coords=[x,x.clone(),x.clone(),x.clone()]}}isValidShape(){return super.isValidShape()&&!this.isNullArea()}isNullArea(){return this.coords[0].x==this.coords[1].x||this.coords[0].y==this.coords[3].y}updateLastCoord(e){return this.coords[1].x=e.x,this.coords[2]=e,this.coords[3].y=e.y,this}},z=class extends S{constructor(t,s="",h=""){super("default",[],s,h);this.iMap=t;this.isDefault=!0}isDrawable(){return!0}isOver(){return!0}display(t){t.rect(0,0,this.iMap.width-1,this.iMap.height-1)}svgArea(t){return'<rect x="0" y="0" width="100%" height="100%" />'}};var I=class{constructor(e,t,s=[],h="",x=!1){this.width=e;this.height=t;this.areas=s;this.name=h;this.hasDefaultArea=x;this.dArea=new z(this);this.lastId=0}setFromObject(e){let t=e;return t.dArea.iMap=this,this.width=t.width,this.height=t.height,this.areas=t.areas.map(S.fromObject),this.name=t.name,this.hasDefaultArea=t.hasDefaultArea,this.dArea=S.fromObject(t.dArea),this}setName(e){return e&&(this.name=e.replace(/\s+/g,"")),this}getName(){return this.name}setSize(e,t){return this.width=e,this.height=t,this}setDefaultArea(e){return this.hasDefaultArea=e,this}getAreas(e=!0){let t=this.areas.slice();return e&&this.hasDefaultArea&&t.push(this.dArea),t}isEmpty(){return this.getAreas().length==0}addArea(e,t=!0){return t&&e.setId(this.getNewId()),this.areas.unshift(e),e.id}rmvArea(e){let t=this.areaIndex(e);return this.areas.splice(t,1),t}moveArea(e,t){let s=this.areaIndex(e),h=this.areas[s],x=s+t;return x<0||x>=this.areas.length?!1:(this.rmvArea(e),this.insertArea(h,x),x)}shiftArea(){return this.areas.shift()}popArea(){return this.areas.pop()}insertArea(e,t){return this.areas.splice(t,0,e),this.areas.length}areaIndex(e){return this.areas.findIndex(t=>t.id==e)}isFirstArea(e){return this.areaIndex(e)==0}isLastArea(e){return this.areaIndex(e)==this.areas.length-1}getNewId(){return this.lastId++,this.lastId}toHtml(e=1){let t=[];return this.getAreas().forEach(s=>{s.isValidShape()&&t.push("	"+s.toHtml(e))}),'<map name="'+this.name+'" id="'+this.name+`">
`+t.join(`
`)+`
</map>`}toSvg(e=1){let t=[];this.getAreas(!1).forEach(h=>{h.isValidShape()&&t.push("	"+h.toSvg(e))});let s='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+this.width+'" height="'+this.height+`">
`;return s+=t.join(`
`),s+=`
</svg>`,s}clearAreas(){return this.areas=[],this}setAreas(e){return this.areas=e,this}};var N=class{constructor(e,t=15,s=0,h=!1){this.iMap=e;this.speed=t;this.alpha=s;this.over=h}appear(){this.over=!0}disappear(){this.over=!1}display(){this.over?this.alpha<100&&(this.alpha+=this.speed):this.alpha>0&&(this.alpha-=this.speed),this.iMap.p5.noStroke(),this.iMap.p5.fill(255,255,255,this.alpha),this.iMap.p5.rect(this.iMap.trueX(0),this.iMap.trueY(0),this.iMap.p5.width/this.iMap.view.scale,this.iMap.p5.height/this.iMap.view.scale)}};var V=class{constructor(){this.origin=new M;this.position=this.origin.clone();this.areas=new Map;this.points=new Map}resetOrigin(e=new M){this.origin=e.clone(),this.position=e,this.addPoint(e)}registerArea(e){this.areas.set(e.getId(),e)}addArea(e){this.registerArea(e),e.getCoords().forEach(t=>this.addPoint(t))}addPoint(e){let t=this.points.get(e)||0;this.points.set(e,t+1)}containsArea(e){return this.areas.has(e.getId())}containsPoint(e){return this.points.has(e)}distToOrigin(){return this.getPosition().diff(this.origin)}clear(){this.areas.clear(),this.points.clear(),this.origin=new M}isEmpty(){return this.points.size==0}move(e){this.points.forEach((t,s)=>{s.move(e)})}getPosition(){return this.position}setPosition(e){let t=e.diff(this.position);this.move(t)}};var ne=B($()),se=B(ee()),oe=B(ie()),L=B(re());var F=class{constructor(e,t){this.version=e;this.map=t}},X=class{constructor(e,t=600,s=450){this.menu={SetUrl:{onSelect:(e,t,s,h)=>{this.setAreaUrl(h)},label:"Set url"},SetTitle:{onSelect:(e,t,s,h)=>{this.setAreaTitle(h)},label:"Set title"},Delete:(e,t,s,h)=>{this.deleteArea(h)},MoveFront:{onSelect:(e,t,s,h)=>{this.moveArea(h,-1)},enabled:!0,label:"Move Forward"},MoveBack:{onSelect:(e,t,s,h)=>{this.moveArea(h,1)},enabled:!0,label:"Move Backward"}};let h=document.getElementById(e);if(!h)throw new Error("HTMLElement not found");this.width=t,this.height=s,this.tool="polygon",this.drawingTools=["rectangle","circle","polygon"],this.settings,this.tempArea=new T,this.selection=new V,this.hoveredArea=null,this.hoveredPoint=null,this.map=new I(t,s),this.undoManager=new se.default,this.img={data:null,file:null},this.view={scale:1,transX:0,transY:0},this.zoomParams={min:.03,max:3,sensativity:.001},this.magnetism=!0,this.fusion=!1,this.tolerance=6,this.bgLayer=new N(this),this.p5=new p5(this.sketch.bind(this),h)}sketch(e){this.p5=e,e.setup=this.setup.bind(this),e.draw=this.draw.bind(this),e.mousePressed=this.mousePressed.bind(this),e.mouseDragged=this.mouseDragged.bind(this),e.mouseReleased=this.mouseReleased.bind(this),e.mouseWheel=this.mouseWheel.bind(this),e.keyPressed=this.keyPressed.bind(this)}setup(){this.p5.createCanvas(this.width,this.height).drop(this.handeFile.bind(this)).dragLeave(this.onLeave.bind(this)).dragOver(this.onOver.bind(this)),this.settings=oe.default.create(this.p5.width+5,0,"Image-map Creator",this.p5.canvas.parentElement).setDraggable(!1).addText("Map Name","",t=>{this.map.setName(t)}).addDropDown("Tool",["polygon","rectangle","circle","select","delete","test"],t=>{this.setTool(t.value)}).addBoolean("Default Area",this.map.hasDefaultArea,t=>{this.setDefaultArea(t)}).addButton("Undo",this.undoManager.undo).addButton("Redo",this.undoManager.redo).addButton("Clear",this.clearAreas.bind(this)).addButton("Generate Html",()=>{this.settings.setValue("Output",this.map.toHtml())}).addButton("Generate Svg",()=>{this.settings.setValue("Output",this.map.toSvg())}).addTextArea("Output").addButton("Save",this.save.bind(this)),this.p5.canvas.addEventListener("contextmenu",t=>{t.preventDefault()}),this.p5.canvas.addEventListener("mousedown",t=>{t.preventDefault()}),document.getElementById("Output").setAttribute("onFocus","this.select();")}draw(){this.updateTempArea(),this.updateHovered(),this.setCursor(),this.setOutput(),this.setBackground(),this.setTitle(this.hoveredArea),this.p5.translate(this.view.transX,this.view.transY),this.p5.scale(this.view.scale),this.drawImage(),this.bgLayer.display(),this.drawAreas()}mousePressed(){if(this.mouseIsHoverSketch()){let e=this.drawingCoord();if(this.p5.mouseButton==this.p5.LEFT&&!L.isOpen())switch(this.tool){case"circle":case"rectangle":this.setTempArea(e);break;case"polygon":let t=this.tempArea;t.isEmpty()?this.setTempArea(e):t.isClosable(this.mCoord(),this.tolerance/this.view.scale)?(t.close(),t.isValidShape()&&this.createArea(t),this.tempArea=new T):this.tempArea.addCoord(this.mCoord());break;case"select":this.hoveredPoint!==null?(this.selection.addPoint(this.hoveredPoint),this.selection.registerArea(this.hoveredArea),this.selection.resetOrigin(this.hoveredPoint)):this.hoveredArea!==null&&(this.selection.addArea(this.hoveredArea),this.selection.resetOrigin(this.mCoord()));break}}}mouseDragged(){if(this.mouseIsHoverSketch()&&!L.isOpen())if(this.p5.mouseButton==this.p5.LEFT)switch(this.tool){case"select":this.selection.setPosition(this.drawingCoord());break}else this.p5.mouseButton==this.p5.CENTER&&(this.view.transX+=this.p5.mouseX-this.p5.pmouseX,this.view.transY+=this.p5.mouseY-this.p5.pmouseY)}mouseReleased(e){switch(this.tool){case"rectangle":case"circle":this.tempArea.isValidShape()&&this.createArea(this.tempArea),this.tempArea=new T;break;case"select":let t=this.selection;if(!t.isEmpty()){let s=this.selection.distToOrigin();this.undoManager.add({undo:()=>t.move(s.invert()),redo:()=>t.move(s)})}this.selection=new V;break}this.onClick(e),this.bgLayer.disappear()}mouseWheel(e){if(this.mouseIsHoverSketch()){let t=this.view.scale*this.zoomParams.sensativity*-e.deltaY;return this.zoom(t),!1}return!0}keyPressed(e){if(e.composed&&e.ctrlKey){switch(e.key){case"s":this.save();break;case"z":this.undoManager.undo();break;case"y":this.undoManager.redo();break;default:return!0}return!1}else if(this.tool=="polygon"&&e.keyCode==this.p5.ESCAPE)return this.tempArea=new T,!1;return!0}trueX(e){return(e-this.view.transX)/this.view.scale}trueY(e){return(e-this.view.transY)/this.view.scale}mX(){return this.trueX(this.p5.mouseX)}mY(){return this.trueY(this.p5.mouseY)}mCoord(){return new M(this.mX(),this.mY())}drawingCoord(){let e=this.mCoord();return e=this.magnetism&&this.hoveredPoint?this.hoveredPoint:e,this.fusion||(e=e.clone()),e}mouseIsHoverSketch(){return this.p5.mouseX<=this.p5.width&&this.p5.mouseX>=0&&this.p5.mouseY<=this.p5.height&&this.p5.mouseY>=0}updateHovered(){this.hoveredPoint=null;let t=this.map.getAreas().find(s=>{if(this.selection.containsArea(s))return!1;if(this.tool!="test"){let h=s.isOverPoint(this.mCoord(),this.tolerance/this.view.scale);if(h&&!this.selection.containsPoint(h))return this.hoveredPoint=h,!0}return!!s.isOver(this.mCoord())});this.p5.mouseIsPressed||(this.hoveredArea=t||null)}onClick(e){if(this.mouseIsHoverSketch()&&this.hoveredArea){if(this.p5.mouseButton==this.p5.RIGHT)this.selection.addArea(this.hoveredArea),this.menu.MoveFront.enabled=!(this.map.isFirstArea(this.hoveredArea.id)||this.hoveredArea.getShape()=="default"),this.menu.MoveBack.enabled=!(this.map.isLastArea(this.hoveredArea.id)||this.hoveredArea.getShape()=="default"),L.display(e,this.menu,{position:"click",data:this.hoveredArea});else if(this.p5.mouseButton==this.p5.LEFT&&!L.isOpen())switch(this.tool){case"test":J(this.hoveredArea.getHref());break;case"delete":this.deleteArea(this.hoveredArea);break}}this.selection.clear()}onOver(e){this.bgLayer.appear(),e.preventDefault()}onLeave(){this.bgLayer.disappear()}handeFile(e){e.type=="image"?(this.img.data=this.p5.loadImage(e.data,t=>this.resetView(t)),this.img.file=e.file,this.map.getName()||(this.map.setName(e.name),this.settings.setValue("Map Name",this.map.getName()))):e.subtype=="json"&&fetch(e.data).then(t=>t.blob()).then(t=>{let s=new FileReader;s.onload=()=>{let h=s.result;typeof h=="string"&&this.importMap(h)},s.readAsText(t)}),this.bgLayer.disappear()}resetView(e){this.view.scale=1,this.view.transX=0,this.view.transY=0;let t=this.p5.width/e.width,s=this.p5.height/e.height;t<this.view.scale&&(this.view.scale=t),s<this.view.scale&&(this.view.scale=s),this.map.setSize(e.width,e.height)}zoom(e){let t=this.view.scale+e;if(t>this.zoomParams.min&&t<this.zoomParams.max){let s=this.mX(),h=this.mY(),x=s*e,_=h*e;this.view.scale=t,this.view.transX-=x,this.view.transY-=_}}drawImage(){this.img.data&&this.p5.image(this.img.data,0,0,this.img.data.width,this.img.data.height)}drawAreas(){let e=[this.tempArea].concat(this.map.getAreas());for(let t=e.length;t--;){let s=e[t];this.setAreaStyle(s),s.isDrawable()&&s.display(this.p5)}if(this.hoveredPoint){let t=this.hoveredPoint;this.p5.fill(0),this.p5.noStroke(),this.p5.ellipse(t.x,t.y,6/this.view.scale)}}setTool(e){this.tool=e,this.tempArea=new T}setCursor(){if(this.drawingTools.includes(this.tool))switch(this.tool){case"polygon":let e=this.tempArea;if(!e.isEmpty()&&e.isClosable(this.mCoord(),5/this.view.scale)){this.p5.cursor(this.p5.HAND);break}default:this.p5.cursor(this.p5.CROSS)}else if(this.p5.cursor(this.p5.ARROW),this.hoveredArea)switch(this.tool){case"test":case"delete":this.p5.cursor(this.p5.HAND);break;case"select":this.hoveredPoint||this.p5.cursor(this.p5.MOVE);break}}setOutput(){switch(this.tool){case"test":case"select":if(this.mouseIsHoverSketch()){let e=this.hoveredArea?this.hoveredArea.getHrefVerbose():"none";this.settings.setValue("Output",e)}break}}setBackground(){this.p5.background(200),this.img.data||(this.p5.noStroke(),this.p5.fill(0),this.p5.textAlign(this.p5.CENTER,this.p5.CENTER),this.p5.textSize(15),this.p5.text("Drag and drop an image and/or a .map.json save file here",this.p5.width/2,this.p5.height/2))}setTitle(e){this.tool=="test"&&e&&e.getTitle()?this.p5.canvas.setAttribute("title",e.getTitle()):this.p5.canvas.removeAttribute("title")}setAreaStyle(e){let t=this.p5.color(255,255,255,178);this.tool=="test"&&(t=this.p5.color(255,0)),((this.tool=="delete"||this.tool=="select")&&this.mouseIsHoverSketch()&&e==this.hoveredArea||this.selection.containsArea(e))&&(t=this.p5.color(255,200,200,178)),this.p5.fill(t),this.p5.strokeWeight(1/this.view.scale),this.tool=="test"?this.p5.noStroke():this.p5.stroke(0)}setTempArea(e){let t=[e];switch(this.tool){case"rectangle":this.tempArea=new P(t);break;case"circle":this.tempArea=new H(t);break;case"polygon":this.tempArea=new E(t),this.tempArea.addCoord(e);break}}updateTempArea(){let e=this.drawingCoord();this.tempArea.isEmpty()||this.tempArea.updateLastCoord(e)}exportMap(){return JSON.stringify(new F(Q,this.map),function(e,t){return t instanceof I&&!(this instanceof F)?t.getName():t})}save(){let e=new Blob([this.exportMap()],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"});(0,ne.default)(e,`${this.map.getName()}.map.json`,"application/json")}importMap(e){let s=JSON.parse(e).map;this.map.setFromObject(s),this.settings.setValue("Map Name",s.name),this.settings.setValue("Default Area",s.hasDefaultArea),this.reset()}createArea(e){this.map.addArea(e),this.undoManager.add({undo:()=>e=this.map.shiftArea(),redo:()=>this.map.addArea(e,!1)})}deleteArea(e){let t=e.id;if(t===0)this.settings.setValue("Default Area",!1);else{let s=this.map.rmvArea(t);this.undoManager.add({undo:()=>this.map.insertArea(e,s),redo:()=>this.map.rmvArea(t)})}}moveArea(e,t){this.map.moveArea(e.id,t)!==!1&&this.undoManager.add({undo:()=>this.map.moveArea(e.id,-t),redo:()=>this.map.moveArea(e.id,t)})}setAreaUrl(e){let t=e.getHref(),s=prompt("Enter the pointing url of this area",t||"http://");s&&(e.setHref(s),this.undoManager.add({undo:()=>e.setHref(t),redo:()=>e.setHref(s)}))}setAreaTitle(e){let t=e.getTitle(),s=prompt("Enter the title of this area",t||"");s&&(e.setTitle(s),this.undoManager.add({undo:()=>e.setTitle(t),redo:()=>e.setTitle(s)}))}setDefaultArea(e){this.map.setDefaultArea(e),this.undoManager.add({undo:()=>{this.map.setDefaultArea(!e),this.settings.setValue("Default Area",!e)},redo:()=>{this.map.setDefaultArea(e),this.settings.setValue("Default Area",e)}})}clearAreas(){let e=this.map.getAreas(!1);this.map.clearAreas(),this.undoManager.add({undo:()=>this.map.setAreas(e),redo:()=>this.map.clearAreas()})}reset(){this.undoManager.clear()}};globalThis.imageMapCreator=X;})();
//# sourceMappingURL=image-map-creator.bundle.js.map
